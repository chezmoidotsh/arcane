---
# CrowdSec AppSec Acquisition Configuration
# Managed by Ansible - DO NOT EDIT MANUALLY
#
# Purpose:
#   Configure CrowdSec AppSec (Application Security / WAF) to listen for HTTP
#   requests and apply security rules. This file dynamically includes all
#   application-specific security profiles based on the deployment configuration.
#
# Configuration:
#   - listen_addr: AppSec HTTP endpoint for Traefik plugin
#   - appsec_configs: List of security rule collections to apply
#
# CrowdSec Rule Collections:
#   - crowdsecurity/appsec-default: Virtual patching rules (in-band, blocking)
#   - crowdsecurity/crs: OWASP CRS rules (out-of-band, detection only)
#
# Note: CRS is configured in out-of-band mode to reduce false positives.
#       It detects attack patterns without blocking, allowing monitoring
#       without disrupting legitimate REST API traffic (PUT, DELETE, PATCH).
#
# Application-Specific Profiles:
#   Custom profiles are automatically included based on configured domains:
#   - custom/allow-pangolin: Pangolin dashboard (always deployed)
#   - custom/allow-jellyfin: Jellyfin media server (if domains configured)
#   - custom/allow-immich: Immich photo management (if domains configured)
#
# Adding New Applications:
#   1. Create allow-{app}.yaml.j2 in appsec-configs/
#   2. Add to crowdsec_appsec_domains in defaults/main.yml
#   3. Add deployment task in tasks/crowdsec.yml
#
listen_addr: 0.0.0.0:7422
appsec_configs:
  # Default CrowdSec AppSec configurations
  - crowdsecurity/appsec-default
  - crowdsecurity/crs

source: appsec
labels:
  type: appsec
