---
# CrowdSec AppSec Configuration - Global Rule Exclusions
# Managed by Ansible - DO NOT EDIT MANUALLY
#
# Purpose:
#   Global profile to disable specific OWASP CRS rules that generate excessive
#   false positives across all applications and domains. These rules are disabled
#   at the global level rather than per-application to simplify management and
#   reduce configuration complexity.
#
# Scope:
#   Applied to ALL requests regardless of domain or application
#
# Disabled Rules:
#   - 911100: HTTP Method Not Allowed
#             Reason: This rule blocks REST API methods (PUT, DELETE, PATCH) which
#                     are standard HTTP methods widely used by modern web applications
#                     and APIs. The default CRS configuration only allows GET, HEAD,
#                     POST, and OPTIONS, which is overly restrictive for contemporary
#                     applications that follow REST architectural patterns.
#
#             Impact: Disabling this rule globally allows all HTTP methods including
#                     PUT, DELETE, PATCH, CONNECT, TRACE. While this reduces false
#                     positives for legitimate REST operations, it also removes
#                     protection against HTTP method abuse attacks.
#
#             Rationale: In modern microservices and web application architectures,
#                        REST APIs are ubiquitous and rely heavily on PUT/DELETE/PATCH
#                        for CRUD operations. Blocking these methods generates constant
#                        false positives that overwhelm security teams and reduce the
#                        effectiveness of the WAF.
#
# Security Considerations:
#   - HTTP method enforcement should be implemented at the application layer
#     (e.g., FastAPI/Django route decorators, OpenAPI specification enforcement)
#   - Network policies and service mesh should restrict which services can
#     communicate with each other regardless of HTTP method
#   - All other OWASP CRS protections remain active (SQL injection, XSS, RCE,
#     command injection, file inclusion, etc.)
#   - Monitor CrowdSec alerts for unusual patterns and anomalies
#   - Consider implementing custom rules for specific method restrictions where
#     truly needed (e.g., blocking TRACE/CONNECT on public endpoints)
#
# Alternative Approaches Considered:
#   1. Per-application whitelisting: Too maintenance-intensive, every new app needs config
#   2. Method-specific allowlists: Still generates false positives for legitimate use cases
#   3. Global disable (chosen): Simplest approach, delegates method enforcement to apps
#
# Known Affected Legitimate Patterns:
#   - REST APIs using PUT for resource updates
#   - REST APIs using DELETE for resource removal
#   - REST APIs using PATCH for partial resource updates
#   - GraphQL mutations over HTTP POST with custom methods
#   - WebDAV operations (PROPFIND, MKCOL, MOVE, COPY)
#
# References:
#   - OWASP CRS Rule 911100: https://coreruleset.org/docs/rules/911100/
#   - CrowdSec AppSec Hooks: https://docs.crowdsec.net/docs/appsec/hooks/
#   - HTTP Methods RFC 7231: https://tools.ietf.org/html/rfc7231#section-4
#   - REST API Design: https://restfulapi.net/http-methods/
#
name: custom/allow-global-rules
default_remediation: ban

# Disable rules globally during in-band processing
pre_eval:
  - filter: |
      IsInBand == true
    apply:
      # Allow all HTTP methods (PUT, DELETE, PATCH, etc.) for REST API operations
      # This removes method-based protection but eliminates false positives
      # from legitimate REST API usage across all applications
      - RemoveInBandRuleByID(911100)
