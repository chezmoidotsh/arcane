apiVersion: v1
kind: Secret
metadata:
  name: robusta-secrets
  namespace: default # TODO Replace with the namespace where Robusta should be deployed
type: Opaque
data:
  ROBUSTA_UI_TOKEN: ZXlKaFkyTnZkVzUwWDJsa0lqb2dJbVU1WldabVkyTTJMV0k1TWpFdE5EaG1NaTFoWXpaakxUSmlOMkZqWXpBNVlUZGpaaUlzSUNKaGNHbGZhMlY1SWpvZ0ltVjVTbWhpUjJOcFQybEtTVlY2U1RGT2FVbHpTVzVTTldORFNUWkphM0JZVmtOS09TNWxlVXB3WXpOTmFVOXBTbnBrV0VKb1dXMUdlbHBUU1hOSmJrcHNXbWxKTmtsdFdtdGFWMFkyWTFkS2FGb3pRalJsYlhob1pGY3hhVmxYYUROSmFYZHBZMjA1YzFwVFNUWkpiVVoxWWpJMGFVeERTbkJaV0ZGcFQycEZNMDVxWXpGTmVrVXdUV3BGYzBsdFZqUmpRMGsyVFdwQk5FMTZSWGRPZWxGNVRWZ3dMalJyY1dabGJHVTRjSGhLUVVaTFpsWk9Na04xYXpSdmNFeDVORFp4TjAxZlRVRnBSRnB3Y2pGU1NHc2lMQ0FpYzNSdmNtVmZkWEpzSWpvZ0ltaDBkSEJ6T2k4dmMzQXVaWFV1Y205aWRYTjBZUzVrWlhZaUxDQWlaVzFoYVd3aU9pQWlZWEJwZFhObGNpMWphR1Y2Ylc5cExYTm9MVGsxTURCQWNtOWlkWE4wWVM1a1pYWWlMQ0FpY0dGemMzZHZjbVFpT2lBaVlqWXlabUUwT1RFdFlXRTBPQzAwWlRNeUxUa3dOV010WVRCbVl6ZzBaV1ZqWm1JMkluMD0=

---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: robusta
  namespace: argocd # TODO Replace with the namespace where ArgoCD is deployed
  labels:
    robusta-argo-config-version: 0.0.1
spec:
  project: default
  destination:
    server: https://kubernetes.default.svc
    namespace: default # TODO Replace with the namespace where Robusta should be deployed
  sources:
    - chart: robusta
      repoURL: https://robusta-charts.storage.googleapis.com
      targetRevision: 0.32.x
      helm:
        values: |
          clusterName: lungmen.akn
          enableHolmesGPT: true
          enablePlatformPlaybooks: true
          enablePrometheusStack: false
          enabledManagedConfiguration: true
          globalConfig:
            account_id: e9effcc6-b921-48f2-ac6c-2b7acc09a7cf
            signing_key: e8526a18-8ad2-4bab-978b-b40bd02c6e20
          holmes:
            additionalEnvVars:
            - name: ROBUSTA_AI
              value: 'true'
            - name: ROBUSTA_API_ENDPOINT
              value: https://api.eu.robusta.dev
            - name: ROBUSTA_UI_DOMAIN
              value: https://platform.eu.robusta.dev
            - name: ROBUSTA_UI_TOKEN
              valueFrom:
                secretKeyRef:
                  key: ROBUSTA_UI_TOKEN
                  name: robusta-secrets
            resources:
              requests:
                memory: 512Mi
          isSmallCluster: true
          runner:
            additional_env_vars:
            - name: RELAY_EXTERNAL_ACTIONS_URL
              value: https://api.eu.robusta.dev/integrations/generic/actions
            - name: WEBSOCKET_RELAY_ADDRESS
              value: wss://relay.eu.robusta.dev
            - name: ROBUSTA_UI_DOMAIN
              value: https://platform.eu.robusta.dev
            - name: ROBUSTA_TELEMETRY_ENDPOINT
              value: https://api.eu.robusta.dev/telemetry
            - name: ROBUSTA_UI_TOKEN
              valueFrom:
                secretKeyRef:
                  key: ROBUSTA_UI_TOKEN
                  name: robusta-secrets
            sendAdditionalTelemetry: true
          sinksConfig:
          - robusta_sink:
              name: robusta_ui_sink
              token: '{{ env.ROBUSTA_UI_TOKEN }}'
