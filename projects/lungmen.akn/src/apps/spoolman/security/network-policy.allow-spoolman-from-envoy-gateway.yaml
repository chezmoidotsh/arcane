apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  annotations:
    policy.networking.k8s.io/description: |
      Allow ingress traffic to Spoolman web application from Envoy Gateway.
      This enables external access to the Spoolman web UI through the ingress gateway
      while maintaining security through OIDC authentication at the gateway level.
  name: allow-spoolman-from-envoy-gateway
spec:
  endpointSelector:
    matchLabels:
      app.kubernetes.io/name: spoolman
      app.kubernetes.io/instance: spoolman
  ingress:
    - fromEndpoints:
        - matchLabels:
            io.kubernetes.pod.namespace: envoy-gateway-system
            gateway.envoyproxy.io/owning-gateway-name: default
      toPorts:
        - ports:
            - port: "8000"
              protocol: TCP
