---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: actual-budget-configuration
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault.chezmoi.sh
  dataFrom:
    - extract:
        key: lungmen.akn/actual-budget/auth/oidc-client
  target:
    name: actual-budget-configuration
    template:
      type: Opaque
      engineVersion: v2
      data:
        config.json: |
          {
            "openId": {
              "authMethod": "openid",
              "client_id": "{{ .client_id }}",
              "client_secret": "{{ .client_secret }}",
              "discoveryURL": "{{ .issuer_url }}/.well-known/openid-configuration",
              "server_hostname": "https://budget.chezmoi.sh"
            }
          }
