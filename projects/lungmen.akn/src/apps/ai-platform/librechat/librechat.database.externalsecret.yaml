---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: librechat-database-credentials
spec:
  data:
    # PostgreSQL password (RAG API â€” pgvector)
    - secretKey: pg_password
      remoteRef:
        key: lungmen.akn/librechat/database/postgresql
        property: password
    # MongoDB password (LibreChat main database)
    - secretKey: mongo_password
      remoteRef:
        key: lungmen.akn/librechat/database/mongodb
        property: password
  refreshInterval: 5m
  secretStoreRef:
    kind: ClusterSecretStore
    name: vault.chezmoi.sh
  target:
    template:
      data:
        # PostgreSQL credentials (RAG API)
        username: librechat
        password: "{{ .pg_password }}"
        # MongoDB credentials (Percona Server for MongoDB)
        mongo_password: "{{ .mongo_password }}"
        MONGO_URI: "mongodb://librechat:{{ .mongo_password | urlquery }}@librechat-mongodb-rs0.open-webui.svc.cluster.local:27017/librechat?authSource=admin&tls=false"
