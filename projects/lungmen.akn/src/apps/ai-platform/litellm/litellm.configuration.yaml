---
apiVersion: v1
kind: ConfigMap
metadata:
  name: litellm-config
data:
  # ==========================================
  # General
  # ==========================================

  # Log level for the LiteLLM proxy (keep output visible)
  LITELLM_LOG: "INFO"

  # Disable load_dotenv() in production
  LITELLM_MODE: "PRODUCTION"

  # Base URL of the LiteLLM proxy (used for SSO callbacks)
  PROXY_BASE_URL: https://llm.chezmoi.sh

  # Use prisma migrate deploy for DB migrations
  USE_PRISMA_MIGRATE: "True"

  # ==========================================
  # SSO / OIDC (Pocket ID)
  # ==========================================

  # Generic OIDC endpoints for Pocket ID at auth.chezmoi.sh
  GENERIC_AUTHORIZATION_ENDPOINT: https://auth.chezmoi.sh/authorize
  GENERIC_TOKEN_ENDPOINT: https://auth.chezmoi.sh/api/oidc/token
  GENERIC_USERINFO_ENDPOINT: https://auth.chezmoi.sh/api/oidc/userinfo
  GENERIC_SCOPE: openid email profile groups
  
  # Pocket ID enforces PKCE
  GENERIC_CLIENT_USE_PKCE: "true"

  # Auto redirect UI login to SSO
  AUTO_REDIRECT_UI_LOGIN_TO_SSO: "true"

  # OIDC Admin Role mapping
  # Pocket ID sends groups in the `groups` scope
  GENERIC_USER_ROLE_ATTRIBUTE: "groups"
  GENERIC_SSO_ADMIN_ROLE: "admin"

  # ==========================================
  # Cache (Valkey / Redis)
  # ==========================================

  # Valkey connection for LiteLLM caching (db index 4)
  REDIS_HOST: valkey.ai-platform.svc.cluster.local
  REDIS_PORT: "6379"
  REDIS_DB: "4"
