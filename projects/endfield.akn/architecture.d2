vars: {
  d2-config: {
    layout-engine: elk
    sketch: true
  }
}

...@../../docs/assets/d2/architecture-styles.d2

explanation: |md
  # Endfield Industries Architecture

  This document describes the architecture \
  of the Endfield Industries platform in a visual way \
  with all the components and how they \
  interact with each other.

  Endfield Industries focuses purely on raw \
  local AI inference (LLMs, TTS, STT) hosted \
  bare-metal like Yvonne (Mac Studio), delegating \
  higher-level AI Platform abstractions to \
  the lungmen.akn Kubernetes cluster.
| {
  near: top-left
}

# â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
# â”‚                              External Objects                              â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ Desc:                                                                      â”‚
# â”‚   These objects represent resources external to the endfield.akn platform  â”‚
# â”‚   but which interact with or are used by it.                               â”‚
# â”‚   They include networks, hardware, or third-party services                 â”‚
# â”‚   essential for the proper functioning, connectivity, security,            â”‚
# â”‚   or management of the platform.                                           â”‚
# â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Networks

internet: {class: network}
localnet: {class: network}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# External Clusters

lungmenÂ·akn: {
  class: [application]
  label: lungmen.akn
  icon: ../lungmen.akn/assets/logo.light.svg
  tooltip: Home applications cluster hosting the higher-level AI Platform

  ai-platform: {
    class: [namespace]
    label: AI Platform Stack

    LiteLLM: {
      class: [application]
      icon: assets/icons/apps/litellm.svg
      link: https://github.com/BerriAI/litellm
      tooltip: LiteLLM proxy â€” aggregates local and remote LLM providers behind a single OpenAI-compatible API.
    }

    OpenWebUI: {
      class: [application]
      icon: assets/icons/apps/open-webui.svg
      link: https://github.com/open-webui/open-webui
      tooltip: Extensible, feature-rich, and user-friendly self-hosted WebUI for LLMs.
    }

    MCPs: {
      class: [applications]
      label: MCP Servers
      icon: assets/icons/apps/mcp.svg
      tooltip: MCP servers â€” virtual MCPs running on Kubernetes.
    }

    Firecrawl: {
      class: [application]
      icon: assets/icons/apps/firecrawl.svg
      link: https://github.com/mendableai/firecrawl
      tooltip: Web scraping and crawling API optimized for LLMs.
    }

    Valkey: {
      class: [application-datastore]
      icon: assets/icons/apps/valkey.svg
      link: https://valkey.io/
      tooltip: Valkey cache (drop-in Redis) for messaging queues and rapid data access.
    }

    ToolHive: {
      class: [application]
      icon: assets/icons/apps/toolhive.svg
      link: https://github.com/stacklok/toolhive
      tooltip: Kubernetes operator for managing AI capabilities, tools and Virtual MCP servers.
    }
  }

  databases: {
    class: [namespace]
    label: Shared Databases

    PostgreSQL: {
      class: [application-datastore]
      icon: assets/icons/system/cloudnativepg.svg
      link: https://www.postgresql.org/
      tooltip: PostgreSQL with pgvector extension for vector similarity search and storing AI embeddings.
    }
  }
}

# â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
# â”‚                         Endfield Industries Platform                       â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ Desc:                                                                      â”‚
# â”‚   This namespace contains the core inference engines running bare-metal    â”‚
# â”‚   on Yvonne, the Mac Studio dedicated to AI tasks.                         â”‚
# â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

endfieldÂ·akn: {
  icon: assets/logo.light.svg
  style.fill-pattern: none

  yvonne: {
    label: ğŸ’» Yvonne (Mac Studio M1 Max â€” 32 GB)
    style.fill-pattern: none

    engines: {class: [namespace]}

    # ğŸ¤– Local Inference Engines
    engines.LMStudio: {
      class: [application]
      icon: assets/icons/apps/lmstudio.png
      link: https://lmstudio.ai/
      tooltip: LM Studio â€” local LLM inference server running on Apple Silicon's GPU and Neural Engine.
    }

    engines.Kokoro: {
      class: [application]
      icon: assets/icons/apps/kokoro.svg
      link: https://github.com/remsky/Kokoro-FastAPI
      tooltip: Kokoro FastAPI â€” fast, local text-to-speech synthesis API.
    }

    engines.Caddy: {
      class: [application]
      icon: assets/icons/apps/caddy.svg
      link: https://caddyserver.com/
      tooltip: Caddy â€” reverse proxy exposing LM Studio and Kokoro securely on the network.
    }
  }
}

# â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
# â”‚                                Connections                                 â”‚
# â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚ Desc:                                                                      â”‚
# â”‚   This section describes the connections between the AI engines on Yvonne  â”‚
# â”‚   and the AI Platform residing on lungmen.akn.                             â”‚
# â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Intra-Platform Connections (Yvonne)

endfieldÂ·akn.yvonne.engines.Caddy -> endfieldÂ·akn.yvonne.engines.LMStudio: {source-arrowhead: HTTP (8234)}
endfieldÂ·akn.yvonne.engines.Caddy -> endfieldÂ·akn.yvonne.engines.Kokoro: {source-arrowhead: HTTP (8880)}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# External Connections

localnet -> lungmenÂ·akn.ai-platform.OpenWebUI: {
  source-arrowhead: |md
    HTTP (80)
    HTTPS (443)
  |
}

lungmenÂ·akn.ai-platform.Firecrawl -> lungmenÂ·akn.ai-platform.Valkey: "Queue operations (6379)"
lungmenÂ·akn.ai-platform.Firecrawl -> internet: "Web scraping (443)"
lungmenÂ·akn.ai-platform.LiteLLM -> endfieldÂ·akn.yvonne.engines.Caddy: "OpenAI API interface (8234)"
lungmenÂ·akn.ai-platform.LiteLLM -> internet: "External LLM API (443)"
lungmenÂ·akn.ai-platform.OpenWebUI -> lungmenÂ·akn.ai-platform.Firecrawl: "Requires Web searching/scraping (???)"
lungmenÂ·akn.ai-platform.OpenWebUI -> lungmenÂ·akn.ai-platform.LiteLLM: "OpenAI API interface (???)"
lungmenÂ·akn.ai-platform.OpenWebUI -> lungmenÂ·akn.ai-platform.MCPs: "MCP interfaction"
lungmenÂ·akn.ai-platform.OpenWebUI -> lungmenÂ·akn.ai-platform.Valkey: "Queue operations (6379)"
lungmenÂ·akn.ai-platform.OpenWebUI -> lungmenÂ·akn.databases.PostgreSQL: "Database operations (5432)"
lungmenÂ·akn.ai-platform.ToolHive -> lungmenÂ·akn.ai-platform.MCPs: "manages"
