{
	"$schema": "https://docs.renovatebot.com/renovate-schema.json",
	"extends": [
		"github>chezmoidotsh/renovate-config",
		"github>chezmoidotsh/renovate-config:github-actions(monthly)",
		"github>chezmoidotsh/renovate-config:gitmoji"
	],
	"kubernetes": {
		"fileMatch": ["(^|/)kustomization\\.yaml$"]
	},
	"regexManagers": [
		{
			"description": "Update app.kubernetes.io/version labels in Kustomize files",
			"fileMatch": ["(^|/)kustomization\\.yaml$"],
			"matchStrings": [
				"#\\s*renovate:\\s*datasource=(?<datasource>\\S+)\\s+depName=(?<depName>\\S+?)(?:\\s+registryUrl=(?<registryUrl>\\S+))?\\s+app\\.kubernetes\\.io/version:\\s*[\"']?(?<currentValue>[^\"'\\s]+)"
			],
			"datasourceTemplate": "{{#if datasource}}{{{datasource}}}{{else}}docker{{/if}}"
		},
		{
			"description": "Update Kustomize image overrides with renovate comments",
			"fileMatch": ["(^|/)kustomization\\.yaml$"],
			"matchStrings": [
				"#\\s*renovate:\\s*datasource=(?<datasource>\\S+)\\s+depName=(?<depName>\\S+?)(?:\\s+registryUrl=(?<registryUrl>\\S+))?\\s+-\\s+name:\\s+\\S+\\s+newTag:\\s*[\"']?(?<currentValue>[^\"'\\s]+)"
			],
			"datasourceTemplate": "{{#if datasource}}{{{datasource}}}{{else}}docker{{/if}}"
		}
	],
	"packageRules": [
		{
			"description": "Group Kubernetes label and image updates together for same application",
			"matchDatasources": ["docker", "helm"],
			"matchFileNames": ["projects/**/kustomization.yaml"],
			"groupName": "{{depName}}"
		},
		{
			"description": "Label manual-sync applications (asterisk prefix) for identification",
			"matchFileNames": [
				"projects/**/src/apps/\\**/kustomization.yaml",
				"projects/**/src/infrastructure/kubernetes/\\**/kustomization.yaml"
			],
			"labels": ["type: dependencies", "sync: manual"]
		}
	]
}
